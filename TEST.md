# TanLabs 实验板测试指南

请按如下步骤测试实验板的各项功能，以防在实验时发生意外。

**准备实验环境**

首先，将实验板的MIO4拨码开关拨至ON的**另一侧**，并将MIO5拨码开关拨至ON的**同侧**。

将实验板的Micro USB接口（USB_OTG，不是USB_OTG1）与实验者计算机连接，然后将12V电源连接至实验板DC输入接口。

闭合实验板电源开关（Power），绿色电源指示灯应当亮起。一段时间后，蓝色指示灯应当亮起，说明Zynq已成功启动。同时，实验者计算机应能检测到一个新的USB设备。若蓝色指示灯没有亮起，说明Zynq损坏。

在浏览器中访问 http://192.168.8.8/ ，应当出现实验板控制面板。在此页面中上传`tanlabs-post.bit`设计文件，一段时间后应当写入成功。此后的设计文件上传流程是类似的。

请注意，实验板上各类元件，包括Zynq芯片、FPGA芯片以及SFP+接口和模块将会很烫，请勿随意触摸。

**Zynq读写SRAM测试**

在实验板控制面板中“Flash与RAM读写”一栏，设置如下参数：

* 存储选择：`BaseRAM`
* 起始地址：`0x0`
* 写入数据：选择`random.bin`上传

然后点按“写入”按钮，进行基本SRAM的写入。一段时间后，应当写入成功。

此时，将“读取数据”设置为`0x800000`，然后点按“读取”按钮，进行基本SRAM的读取。一段时间后，应当读取成功，浏览器应当开始下载文件。假设下载的文件名为`base-0-800000.bin`。

随后，在本地运行`diff random.bin base-0-800000.bin`命令。特别地，Windows系统下可以使用PowerShell运行`diff (get-content .\random.bin) (get-content .\base-0-800000.bin)`命令。若`diff`提示两个输入文件不相同，说明Zynq读写基本SRAM功能损坏。

请注意，进行完此项测试后，需要重新上传`tanlabs-post.bit`设计文件，以便进行后续测试。

**灯测试**

上传设计文件后，所有SFP+状态指示灯（SFP+ 0~3）、所有数码管（DS1及DS2）以及所有LED灯（D15~D0）应当全部点亮并持续约一秒，然后全部熄灭并持续约一秒。若某个灯无法点亮或者熄灭，则说明该灯损坏。

然后，左上侧四个LED灯（D15~D12）应当闪烁。

**按钮测试**

此时，左侧数码管（DS1）应当显示`0`。不断点按右侧微动开关（BTN5，一般用作手动时钟按钮），左侧数码管显示数字应当从`0`逐渐增加至`F`后返回`0`。在左侧数码管非`0`的情况下，点按复位开关（BTN6，左侧微动开关，一般用作复位按钮），左侧数码管应当回到`0`。

**SRAM测试**

此时，右侧数码管（DS2）应当快速交替显示`1`或`3`。等待一段时间后（至少交替五轮后），右侧数码管应当继续快速交替显示`1`或`3`。

若右侧数码管数值变为`6`，其数值此后应当不再变化，此时说明SRAM功能损坏。

点按复位开关可重新开始该项测试。

**DRAM测试**

一段时间后，右上侧LED灯D8应当点亮。若等待5秒后其仍不点亮，则说明DRAM初始化失败，SODIMM插座或SODIMM内存模块损坏。

此时，右上侧LED灯D9应当保持常亮。若其熄灭，则说明DRAM测试不通过，SODIMM插座或SODIMM内存模块损坏。

等待约1.5分钟后，右上侧LED灯D10应当点亮，说明DRAM第一轮测试通过。若其不能点亮，一段时间后右上侧LED灯D9应当熄灭，说明DRAM测试不通过，SODIMM插座或SODIMM内存模块损坏。

**网络接口测试**

移去四个SFP+接口的所有以太网线，此时，下侧八个LED灯（D7~D0）应当全部熄灭。

使用一根以太网线连接SFP+ 0号接口以及SFP+ 1号接口，一段时间后，D0及D2应当点亮。

使用另一根以太网线连接SFP+ 2号接口以及SFP+ 3号接口，一段时间后，D4及D6应当点亮。

使用另外两根以太网线重复上述过程。

在本文所述的测试过程中，不要将任何一个SFP+接口用以太网线连接至实验者计算机或实验者的网络，因为实验板连续产生的测试用最短以太网帧可能会使前述计算机或网络损坏。在上传了实验者的设计文件后，方可将SFP+接口连接至实验者的设备。

在上述过程中，若上述LED灯中一个或多个没有点亮，或者D1、D3、D5或D7发生较频繁的闪烁，说明FPGA收发器、SFP+接口、SFP模块或以太网线损坏。

点按复位开关可重新开始该项测试。

**HDMI接口测试**

将显示器连接至HDMI接口（LAB_HDMI），显示器应当从左至右、从上到下显示长宽均约三分之一的纯红色、纯绿色、纯蓝色、纯青色、纯品红色、纯黄色、纯黑色、纯白色以及纯灰色色块。若不能显示，说明HDMI接口损坏。
